"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5368],{5368:(H,C,g)=>{g.r(C),g.d(C,{NewUserModule:()=>G});var _=g(6814),h=g(4091),v=g(5861),f=g(95),b=g(6532),U=g(553),y=g(8645),Z=g(3620),e=g(9212),c=g(3282),N=g(2105),k=g(8632),T=g(7229),w=g(5233);function O(t,u){1&t&&e._uU(0," Select Location ")}function P(t,u){1&t&&e._uU(0," Edit Location ")}function A(t,u){1&t&&e._UZ(0,"ion-icon",12)}function I(t,u){1&t&&(e.TgZ(0,"ion-item",13)(1,"ion-label"),e._uU(2,"Address"),e.qZA(),e._UZ(3,"ion-input",14),e.qZA())}function J(t,u){1&t&&(e.TgZ(0,"ion-item",13)(1,"ion-label"),e._uU(2,"Pincode"),e.qZA(),e._UZ(3,"ion-input",15),e.qZA())}function D(t,u){1&t&&(e.TgZ(0,"ion-item",13)(1,"ion-label"),e._uU(2,"Landmark"),e.qZA(),e._UZ(3,"ion-input",16),e.qZA())}function S(t,u){1&t&&(e.TgZ(0,"ion-item",13)(1,"ion-label"),e._uU(2,"SAVE AS"),e.qZA(),e.TgZ(3,"ion-segment",17)(4,"ion-segment-button",18),e._UZ(5,"ion-icon",19),e.TgZ(6,"ion-label"),e._uU(7,"Home"),e.qZA()(),e.TgZ(8,"ion-segment-button",20),e._UZ(9,"ion-icon",21),e.TgZ(10,"ion-label"),e._uU(11,"Office"),e.qZA()(),e.TgZ(12,"ion-segment-button",22),e._UZ(13,"ion-icon",23),e.TgZ(14,"ion-label"),e._uU(15,"Other"),e.qZA()()()())}function Q(t,u){if(1&t){const r=e.EpF();e.TgZ(0,"div",39),e.NdJ("click",function(){const i=e.CHM(r).$implicit,d=e.oxw(3);return e.KtG(d.pinplace(i.value))}),e._uU(1),e.qZA()}if(2&t){const r=u.$implicit;e.xp6(),e.Oqu(r.textContent)}}function L(t,u){if(1&t&&(e.TgZ(0,"div",37),e.YNc(1,Q,2,1,"div",38),e.qZA()),2&t){const r=e.oxw(2);e.xp6(),e.Q6J("ngForOf",r.dropdownOptions)}}function q(t,u){if(1&t){const r=e.EpF();e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",24)(3,"ion-button",4),e.NdJ("click",function(){e.CHM(r);const o=e.oxw();return e.KtG(o.isOpenMaps=!1)}),e._uU(4,"Cancel"),e.qZA()(),e.TgZ(5,"ion-title"),e._uU(6,"Pin your location"),e.qZA(),e.TgZ(7,"ion-buttons",25)(8,"ion-button",26),e.NdJ("click",function(){e.CHM(r);const o=e.oxw();return e.KtG(o.saveLocation())}),e._uU(9,"Save"),e.qZA()()()(),e.TgZ(10,"ion-content",27)(11,"div",28)(12,"div",29)(13,"ion-text",30),e._uU(14," Place the pin accurately on the map. "),e.qZA()(),e.TgZ(15,"div",31)(16,"ion-input",32),e.NdJ("ngModelChange",function(o){e.CHM(r);const i=e.oxw();return e.KtG(i.searchInput=o)})("keyup",function(o){e.CHM(r);const i=e.oxw();return e.KtG(i.onKeyUp(o))}),e.qZA(),e.YNc(17,L,2,1,"div",33),e.qZA(),e.TgZ(18,"div",34),e._UZ(19,"capacitor-google-map",35,36),e.TgZ(21,"ion-button",9),e.NdJ("click",function(){e.CHM(r);const o=e.oxw();return e.KtG(o.saveLocation())}),e._uU(22,"Confirm Location"),e.qZA()()()()}if(2&t){const r=e.oxw();e.xp6(8),e.Q6J("disabled",null==r.coordinates),e.xp6(8),e.Q6J("ngModel",r.searchInput),e.xp6(),e.Q6J("ngIf",r.showPopup),e.xp6(4),e.Q6J("disabled",null==r.coordinates)}}const Y=[{path:"",component:(()=>{var t;class u{constructor(n,o,i,d,a,p,l){this.formBuilder=n,this.loadingCtrl=o,this.dbService=i,this.router=d,this.uuidService=a,this.loadingController=p,this.toastController=l,this.showPopup=!1,this.searchInput="",this.dropdownOptions=[],this.selectedPlace={latitude:0,longitude:0},this.locationRegistered=!1,this.searchSubject=new y.x,this.phoneMask={mask:["+","9","1",/\d/,/\d/,/\d/,/\d/,/\d/,/\d/,/\d/,/\d/,/\d/,/\d/]},this.cardMask={mask:[...Array(4).fill(/\d/)," ",...Array(4).fill(/\d/)," ",...Array(4).fill(/\d/)," ",...Array(4).fill(/\d/)," ",...Array(3).fill(/\d/)]},this.maskPredicate=function(){var s=(0,v.Z)(function*(m){return m.getInputElement()});return function(m){return s.apply(this,arguments)}}(),this.isOpenMaps=!1,this.newMap=null,this.markerId="",this.coordinates=null,this.apiKey=U.N.GMAP_API_KEY,this.isDataInvalid=!1,this.registrationForm=this.formBuilder.group({mobileNumber:["",f.kI.compose([f.kI.required])],address:["",f.kI.required],pincode:[""],landmark:[""],tag:["home"]})}ngOnInit(){this.searchSubject.pipe((0,Z.b)(2e3)).subscribe(()=>{this.searchPlace()}),this.dbService.getUserData().then(n=>{n&&(this.userData=n)})}registerUser(){var n=this;return(0,v.Z)(function*(){var o;if(!n.registrationForm.valid)return;const i=yield n.loadingController.create({message:"Registering user..."});yield i.present();const d=null===(o=n.registrationForm)||void 0===o||null===(o=o.get("mobileNumber"))||void 0===o?void 0:o.value;if(n.coordinates&&n.userData.displayName&&n.userData.email&&n.userData.photoUrl&&n.userData.uid){var a,p,l,s,m;let K={user_address_id:n.uuidService.generateSecureUuid(),user_phone:d,default:!0,user_coordinates:n.coordinates,user_address:null===(a=n.registrationForm)||void 0===a||null===(a=a.get("address"))||void 0===a?void 0:a.value,user_pincode:null===(p=n.registrationForm)||void 0===p||null===(p=p.get("pincode"))||void 0===p?void 0:p.value,user_nearby_landmark:null===(l=n.registrationForm)||void 0===l||null===(l=l.get("landmark"))||void 0===l?void 0:l.value,user_address_tag:null===(s=n.registrationForm)||void 0===s||null===(s=s.get("tag"))||void 0===s?void 0:s.value},x={user_name:n.userData.displayName,user_address:[K],user_email:n.userData.email,user_phone:null===(m=n.registrationForm)||void 0===m||null===(m=m.get("mobileNumber"))||void 0===m?void 0:m.value,user_image:n.userData.photoUrl,user_id:n.userData.uid,user_type:"USER"};console.log(x),n.dbService.RegisterUser(x).subscribe(M=>{console.log(M),null==M?i.dismiss().then(R=>{n.toastController.presentToast("Something went wrong. Please try again!","warning")}):i.dismiss().then(R=>{n.router.navigate(["/home"])})})}else console.log("invalid data"),n.registrationForm.disable({onlySelf:!0}),n.isDataInvalid=!0,n.toastController.presentToast("Invalid Data. Please try again!","warning")})()}presentErrorToast(n){var o=this;return(0,v.Z)(function*(){o.toastController.presentToast(n,"danger")})()}openMaps(){this.isOpenMaps=!0}saveLocation(){this.isOpenMaps=!1,this.locationRegistered=!0}mapDelayLoader(){setTimeout(()=>{this.loadMap()},1e3)}loadMap(){var n=this;return(0,v.Z)(function*(){n.showLoading(),console.log("map loading");let o=document.getElementById("map");if(o){var i,d,a,p;try{navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(){var l=(0,v.Z)(function*(s){var m;yield null===(m=n.newMap)||void 0===m?void 0:m.setCamera({coordinate:{lat:s.coords.latitude,lng:s.coords.longitude}}),n.coordinates={lat:s.coords.latitude,lng:s.coords.longitude}});return function(s){return l.apply(this,arguments)}}())}catch{console.error("unable to detect location. Please check location permission")}n.newMap=yield b.b6.create({id:"my-map",element:o,apiKey:n.apiKey,config:{center:{lat:null!==(i=n.coordinates)&&void 0!==i&&i.lat?null===(d=n.coordinates)||void 0===d?void 0:d.lat:11.8666652,lng:null!==(a=n.coordinates)&&void 0!==a&&a.lng?null===(p=n.coordinates)||void 0===p?void 0:p.lng:75.3595632},zoom:18,mapTypeControl:!1},forceCreate:!0}),n.newMap.enableCurrentLocation(!0);try{navigator.geolocation?navigator.geolocation.getCurrentPosition(function(){var l=(0,v.Z)(function*(s){var m;yield null===(m=n.newMap)||void 0===m?void 0:m.setCamera({coordinate:{lat:s.coords.latitude,lng:s.coords.longitude}}),n.addMarker(s.coords.latitude,s.coords.longitude),n.coordinates={lat:s.coords.latitude,lng:s.coords.longitude}});return function(s){return l.apply(this,arguments)}}()):n.addMarker(12.98863,77.75961)}catch{n.addMarker(12.98863,77.75961)}yield n.newMap.setOnMapClickListener(l=>{n.coordinates={lat:l.latitude,lng:l.longitude},n.addMarker(n.coordinates.lat,n.coordinates.lng)}),yield n.newMap.setOnMarkerClickListener(l=>{console.log(l)}),yield n.newMap.setOnMarkerDragEndListener(l=>{console.log(l),n.coordinates={lat:l.latitude,lng:l.longitude}})}})()}addMarker(n,o){var i=this;return(0,v.Z)(function*(){var d;try{var a;i.markerId&&(null===(a=i.newMap)||void 0===a||a.removeMarker(i.markerId))}catch(p){console.error(p)}i.markerId=yield null===(d=i.newMap)||void 0===d?void 0:d.addMarker({title:"Genie will reach here",draggable:!0,coordinate:{lat:n,lng:o}})})()}showLoading(){var n=this;return(0,v.Z)(function*(){(yield n.loadingCtrl.create({message:"Loading Current location",duration:4e3})).present()})()}onKeyUp(n){console.log(n),this.searchSubject.next(n.target.value),this.showPopup=!0}searchPlace(){(new google.maps.places.AutocompleteService).getPlacePredictions({input:this.searchInput},(o,i)=>{i===google.maps.places.PlacesServiceStatus.OK&&(this.dropdownOptions=[],null==o||o.forEach(d=>{const a=document.createElement("option");a.value=d.place_id,a.textContent=d.description,this.dropdownOptions.push(a)}))})}pinplace(n){var o=this;n&&(new google.maps.Geocoder).geocode({placeId:n}).then(function(){var d=(0,v.Z)(function*({results:a}){var p;yield null===(p=o.newMap)||void 0===p?void 0:p.setCamera({coordinate:{lat:a[0].geometry.location.lat(),lng:a[0].geometry.location.lng()}}),o.showPopup=!1,o.addMarker(a[0].geometry.location.lat(),a[0].geometry.location.lng())});return function(a){return d.apply(this,arguments)}}())}onhistoryDismiss(n){this.isOpenMaps=!1}navigatetoLogin(){this.router.navigate(["/login"])}}return(t=u).\u0275fac=function(n){return new(n||t)(e.Y36(f.qu),e.Y36(c.HT),e.Y36(N.$),e.Y36(h.F0),e.Y36(k.B),e.Y36(c.HT),e.Y36(T.i))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-new-user"]],decls:26,vars:16,consts:[[3,"ngClass"],[3,"formGroup","ngClass"],["position","floating"],["formControlName","mobileNumber","required","","helperText","Enter a valid mobile number","errorText","Invalid mobile number","placeholder","+91 xxxxxxxxxx",3,"maskito","maskitoElement"],[3,"click"],["expand","full",2,"flex-grow","1"],["style","color: green;flex-grow: 1","name","checkmark-circle-outline",4,"ngIf"],["color","light",4,"ngIf"],[1,"action-block"],["expand","full",3,"disabled","click"],[1,"map-content",3,"isOpen","didPresent","willDismiss"],["message","Invalid Data",3,"isOpen","duration","didDismiss"],["name","checkmark-circle-outline",2,"color","green","flex-grow","1"],["color","light"],["formControlName","address"],["type","number","formControlName","pincode"],["formControlName","landmark"],["value","home","formControlName","tag","color","primary"],["value","home"],["name","home"],["value","office"],["name","briefcase-outline"],["value","other"],["name","pin-outline"],["slot","start"],["slot","end"],[3,"disabled","click"],[1,"map-content"],[1,"map-selection-container"],[1,"notification-block"],["color","white"],[1,"map-searchbox"],["type","text","placeholder","Search places...","id","location-input",3,"ngModel","ngModelChange","keyup"],["class","placelist-container",4,"ngIf"],[1,"cap-map"],["id","map",1,"hg-map"],["mapRef",""],[1,"placelist-container"],["class","place-item",3,"click",4,"ngFor","ngForOf"],[1,"place-item",3,"click"]],template:function(n,o){1&n&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e._uU(3," User Registration "),e.qZA()()(),e.TgZ(4,"ion-content",0)(5,"form",1)(6,"div",0)(7,"ion-item")(8,"ion-label",2),e._uU(9,"Mobile Number"),e.qZA(),e._UZ(10,"ion-input",3),e.qZA(),e.TgZ(11,"ion-item",4),e.NdJ("click",function(){return o.openMaps()}),e.TgZ(12,"ion-button",5),e.YNc(13,O,1,0)(14,P,1,0),e.qZA(),e.YNc(15,A,1,0,"ion-icon",6),e.qZA(),e.YNc(16,I,4,0,"ion-item",7)(17,J,4,0,"ion-item",7)(18,D,4,0,"ion-item",7)(19,S,16,0,"ion-item",7),e.qZA(),e.TgZ(20,"div",8)(21,"ion-button",9),e.NdJ("click",function(){return o.registerUser()}),e._uU(22," Register "),e.qZA()()(),e.TgZ(23,"ion-modal",10),e.NdJ("didPresent",function(){return o.mapDelayLoader()})("willDismiss",function(d){return o.onhistoryDismiss(d)}),e.YNc(24,q,23,4,"ng-template"),e.qZA(),e.TgZ(25,"ion-toast",11),e.NdJ("didDismiss",function(){return o.navigatetoLogin()}),e.qZA()()),2&n&&(e.xp6(4),e.Q6J("ngClass",o.isOpenMaps?"map-content":"main-map-content"),e.xp6(),e.Q6J("formGroup",o.registrationForm)("ngClass",o.isOpenMaps?"hide-form":"main-form-container"),e.xp6(),e.Q6J("ngClass",o.isOpenMaps?"hide-form":"form-content"),e.xp6(4),e.Q6J("maskito",o.phoneMask)("maskitoElement",o.maskPredicate),e.xp6(3),e.um2(13,o.coordinates?14:13),e.xp6(2),e.Q6J("ngIf",o.locationRegistered),e.xp6(),e.Q6J("ngIf",o.coordinates),e.xp6(),e.Q6J("ngIf",o.coordinates),e.xp6(),e.Q6J("ngIf",o.coordinates),e.xp6(),e.Q6J("ngIf",o.coordinates),e.xp6(2),e.Q6J("disabled",!o.registrationForm.valid),e.xp6(2),e.Q6J("isOpen",o.isOpenMaps),e.xp6(2),e.Q6J("isOpen",o.isDataInvalid)("duration",5e3))},dependencies:[f._Y,f.JJ,f.JL,f.Q7,f.On,f.sg,f.u,c.YG,c.Sm,c.W2,c.Gu,c.gu,c.pK,c.Ie,c.Q$,c.cJ,c.GO,c.yW,c.wd,c.Px,c.sr,c.ki,c.as,c.QI,c.j9,_.mk,_.sg,_.O5,w.ro],styles:[".main-form-container[_ngcontent-%COMP%]{height:100%;display:flex;align-content:space-between;flex-direction:column;justify-content:space-between}#map[_ngcontent-%COMP%]{height:70vh}capacitor-google-map[_ngcontent-%COMP%], .gmap[_ngcontent-%COMP%]{display:inline-block;width:100%;height:70vh}.notification-container[_ngcontent-%COMP%]{background-color:#e8eaf6;border-radius:.2rem;margin:1rem;padding:1rem}.notification-block[_ngcontent-%COMP%]{background:#ef5350;padding:.2rem;border-radius:.2rem;color:#fff;height:2rem}.map-selection-container[_ngcontent-%COMP%]{display:grid;grid-template-rows:auto auto auto 3rem}.map-searchbox[_ngcontent-%COMP%]{display:flex;flex-direction:column;background-color:#fff}.hide-form[_ngcontent-%COMP%]{height:0px;display:none}.map-searchbox[_ngcontent-%COMP%]{background-color:#fff}.map-searchbox[_ngcontent-%COMP%]{position:relative;background-color:#fff}.placelist-container[_ngcontent-%COMP%]{position:absolute;top:calc(100% + 5px);left:0;z-index:1000;background-color:#fff;border:1px solid #ccc;border-radius:4px;box-shadow:0 2px 5px #0003;max-height:200px;overflow-y:auto;width:calc(100% - 2px);transition:opacity .2s ease-in-out;opacity:0;pointer-events:none}.map-searchbox[_ngcontent-%COMP%]:hover   .placelist-container[_ngcontent-%COMP%]{opacity:1;pointer-events:auto}.place-item[_ngcontent-%COMP%]{padding:8px 12px;cursor:pointer}.place-item[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}"]}),u})(),pathMatch:"full"}];let E=(()=>{var t;class u{}return(t=u).\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[h.Bz.forChild(Y),h.Bz]}),u})(),G=(()=>{var t;class u{}return(t=u).\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[f.u5,f.UX,c.Pc,_.ez,w.U5,E]}),u})()}}]);